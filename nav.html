<style>
    /*
     * Stili CSS specifici per la Navbar.
     * Questi stili sono stati scritti per essere compatibili con le variabili
     * globali definite in style.css (--ios-blue, --ios-bg-secondary, etc.),
     * ma definiscono tutto ciò che serve per il layout e l'aspetto della navbar.
     */

    /* --- Contenitore Principale della Navbar --- */
    .navbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 70px; /* Altezza standard della barra */
        background: var(--navbar-bg, rgba(255, 255, 255, 0.8)); /* Sfondo con trasparenza */
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--navbar-border, rgba(0, 0, 0, 0.1));
        z-index: 1000;
        transition: background 0.3s ease, border-color 0.3s ease;
    }

    .ios-dark-mode .navbar {
        background: var(--navbar-bg, rgba(28, 28, 30, 0.8));
        border-bottom-color: var(--navbar-border, rgba(255, 255, 255, 0.2));
    }

    .nav-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }

    /* --- Logo --- */
    .nav-logo {
        display: flex;
        align-items: center;
        gap: 12px;
        text-decoration: none;
        color: var(--ios-text-primary);
        font-weight: 700;
        font-size: 20px;
    }

    .nav-logo-img {
        width: 40px;
        height: 40px;
        border-radius: 8px;
    }

    /* --- Navigazione Desktop --- */
    .nav-desktop {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .nav-link {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        text-decoration: none;
        color: var(--ios-text-secondary);
        font-weight: 500;
        font-size: 14px;
        border-radius: 8px;
        transition: all 0.2s ease;
        position: relative;
        background: none;
        border: none;
        font-family: inherit;
    }

    .nav-link:hover {
        background: var(--ios-fill-quaternary);
        color: var(--custom-primary-color, var(--ios-blue));
    }

    .nav-link.active {
        background: var(--custom-primary-color, var(--ios-blue));
        color: white;
    }
    .nav-link.active:hover {
         color: white;
    }

    /* --- Dropdown Menu (Desktop) --- */
    .nav-dropdown {
        position: relative;
    }

    .dropdown-toggle {
        cursor: pointer;
    }

    .dropdown-arrow {
        transition: transform 0.2s ease;
    }

    .nav-dropdown:hover .dropdown-arrow {
        transform: rotate(180deg);
    }

    .dropdown-menu {
        position: absolute;
        top: calc(100% + 10px);
        right: 0;
        background: var(--ios-bg-secondary);
        border: 1px solid var(--ios-separator-non-opaque);
        border-radius: var(--ios-radius-lg);
        box-shadow: var(--ios-shadow-md);
        min-width: 220px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s ease;
        z-index: 1001;
        padding: 8px;
    }

    .nav-dropdown:hover .dropdown-menu {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .dropdown-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        text-decoration: none;
        color: var(--ios-text-primary);
        font-size: 14px;
        border-radius: 8px;
        transition: background 0.2s ease, color 0.2s ease;
    }

    .dropdown-item:hover {
        background: var(--ios-fill-quaternary);
        color: var(--custom-primary-color, var(--ios-blue));
    }
    
    .dropdown-divider {
        height: 1px;
        background: var(--ios-separator-non-opaque);
        margin: 8px;
    }


    /* --- Pulsanti di Azione (Wishlist, Carrello, etc.) --- */
    .nav-actions {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .nav-button {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border: none;
        background: var(--ios-fill-tertiary);
        border-radius: var(--ios-radius-md);
        cursor: pointer;
        transition: all 0.2s ease;
        text-decoration: none;
        color: var(--ios-text-primary);
    }

    .nav-button:hover {
        background: var(--ios-fill-secondary);
        color: var(--custom-primary-color, var(--ios-blue));
        transform: scale(1.05);
    }

    .nav-button i {
        font-size: 18px;
    }

    /* --- Badge Notifiche --- */
    .nav-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: var(--ios-red);
        color: white;
        font-size: 11px;
        font-weight: 600;
        padding: 2px 6px;
        border-radius: 10px;
        min-width: 18px;
        text-align: center;
        display: block; /* Visibile sempre, il contenuto JS lo popola */
        pointer-events: none;
        opacity: 0; /* Nascosto se vuoto */
        transform: scale(0.5);
        transition: opacity 0.2s ease, transform 0.2s ease;
    }

    .nav-badge.show {
        opacity: 1;
        transform: scale(1);
    }


    /* --- Menu Mobile (Hamburger) --- */
    .mobile-menu-btn {
        display: none; /* Nascosto su desktop */
    }

    .mobile-menu {
        position: fixed;
        top: 0;
        right: -100%; /* Fuori schermo di default */
        width: 320px;
        max-width: 90%;
        height: 100vh;
        background: var(--ios-bg-secondary);
        z-index: 1002;
        transition: right 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        overflow-y: auto;
        box-shadow: -5px 0 20px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
    }

    .mobile-menu.active {
        right: 0; /* Entra in scena */
    }

    .mobile-menu-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        height: 70px;
        border-bottom: 1px solid var(--ios-separator-non-opaque);
        flex-shrink: 0;
    }

    .mobile-menu-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--ios-text-primary);
    }

    .mobile-menu-content {
        padding: 24px;
        flex-grow: 1;
    }

    .mobile-nav-section {
        margin-bottom: 32px;
    }

    .mobile-nav-section:last-child {
        margin-bottom: 0;
    }

    .mobile-nav-section h4 {
        font-size: 12px;
        font-weight: 600;
        color: var(--ios-text-secondary);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 16px;
    }

    .mobile-nav-list {
        list-style: none;
        margin: 0;
        padding: 0;
    }
    
    .mobile-nav-link {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 12px;
        text-decoration: none;
        color: var(--ios-text-primary);
        font-size: 16px;
        border-radius: 8px;
        transition: all 0.2s ease;
        font-weight: 500;
    }

    .mobile-nav-link:hover {
        background: var(--ios-fill-quaternary);
        color: var(--custom-primary-color, var(--ios-blue));
    }
    
    .mobile-nav-link.active {
        background: var(--custom-primary-color, var(--ios-blue));
        color: white;
        font-weight: 600;
    }
    .mobile-nav-link.active i {
         color: white;
    }


    .mobile-nav-link i {
        font-size: 20px;
        width: 24px;
        text-align: center;
        color: var(--ios-text-secondary);
    }

    /* --- Overlay per sfondo menu mobile --- */
    .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1001;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.4s ease, visibility 0.4s ease;
    }

    .overlay.active {
        opacity: 1;
        visibility: visible;
    }

    /* --- Stili Responsive --- */
    @media (max-width: 1024px) {
        .nav-desktop {
            display: none; /* Nasconde il menu desktop su tablet e mobile */
        }
        
        .mobile-menu-btn {
            display: flex; /* Mostra il pulsante hamburger */
        }
    }

    @media (max-width: 768px) {
        .nav-content {
            padding: 0 15px;
        }
        
        .nav-logo-text {
            display: none; /* Nasconde il testo del logo su schermi piccoli */
        }
        
        .mobile-menu {
            width: 280px; /* Riduce la larghezza del menu mobile */
        }
    }
</style>

<nav class="navbar">
    <div class="nav-content">
        <a href="index.html" class="nav-logo">
            <img src="assets/cronoshop-logo.png" alt="Cronoshop Logo" class="nav-logo-img">
            <span class="nav-logo-text">Cronoshop</span>
        </a>

        <div class="nav-desktop">
            <a href="index.html" class="nav-link" data-page="index"><i class="ph ph-house"></i> Home</a>
            <a href="products.html" class="nav-link" data-page="products"><i class="ph ph-shopping-bag"></i> Offerte</a>
            <a href="categorie.html" class="nav-link" data-page="categorie"><i class="ph ph-squares-four"></i> Categorie</a>
            <a href="cronoai.html" class="nav-link" data-page="cronoai"><i class="ph ph-robot"></i> CronoAI</a>
            <div class="nav-dropdown">
                <button class="nav-link dropdown-toggle">
                    <i class="ph ph-dots-three"></i> Altro <i class="ph ph-caret-down dropdown-arrow"></i>
                </button>
                <div class="dropdown-menu">
                    <a href="chisiamo.html" class="dropdown-item" data-page="chisiamo"><i class="ph ph-info"></i> Chi Siamo</a>
                    <a href="stats.html" class="dropdown-item" data-page="stats"><i class="ph ph-chart-bar"></i> Statistiche</a>
                    <a href="themes.html" class="dropdown-item" data-page="themes"><i class="ph ph-palette"></i> Temi</a>
                    <a href="faq.html" class="dropdown-item" data-page="faq"><i class="ph ph-question"></i> FAQ</a>
                    <div class="dropdown-divider"></div>
                    <a href="privacy.html" class="dropdown-item" data-page="privacy"><i class="ph ph-shield-check"></i> Privacy</a>
                    <a href="terms.html" class="dropdown-item" data-page="terms"><i class="ph ph-file-text"></i> Termini</a>
                </div>
            </div>
        </div>

        <div class="nav-actions">
            <a href="wishlist.html" class="nav-button" title="Wishlist">
                <i class="ph ph-heart"></i>
                <span class="nav-badge wishlist-count">0</span>
            </a>
            <a href="cart.html" class="nav-button" title="Carrello">
                <i class="ph ph-shopping-cart"></i>
                <span class="nav-badge cart-count">0</span>
            </a>
            <a href="account.html" class="nav-button" title="Account">
                <i class="ph ph-user"></i>
            </a>
            <button class="nav-button theme-btn" id="themeToggleBtn" title="Cambia tema">
                <i class="ph ph-moon"></i>
            </button>
            <button class="nav-button mobile-menu-btn" title="Menu">
                <i class="ph ph-list"></i>
            </button>
        </div>
    </div>
</nav>

<div class="mobile-menu" id="mobileMenu">
    <div class="mobile-menu-header">
        <span class="mobile-menu-title">Menu</span>
        <button class="nav-button close-menu-btn">
            <i class="ph ph-x"></i>
        </button>
    </div>
    <div class="mobile-menu-content">
        <div class="mobile-nav-section">
            <h4>Navigazione</h4>
            <ul class="mobile-nav-list">
                <li><a href="index.html" class="mobile-nav-link" data-page="index"><i class="ph ph-house"></i>Home</a></li>
                <li><a href="products.html" class="mobile-nav-link" data-page="products"><i class="ph ph-shopping-bag"></i>Offerte</a></li>
                <li><a href="categorie.html" class="mobile-nav-link" data-page="categorie"><i class="ph ph-squares-four"></i>Categorie</a></li>
                <li><a href="cronoai.html" class="mobile-nav-link" data-page="cronoai"><i class="ph ph-robot"></i>CronoAI</a></li>
                <li><a href="blog.html" class="mobile-nav-link" data-page="blog"><i class="ph ph-article"></i>Blog</a></li>
                <li><a href="groups.html" class="mobile-nav-link" data-page="groups"><i class="ph ph-users"></i>Community</a></li>
            </ul>
        </div>
        <div class="mobile-nav-section">
            <h4>Account & Strumenti</h4>
            <ul class="mobile-nav-list">
                <li><a href="account.html" class="mobile-nav-link" data-page="account"><i class="ph ph-user"></i>Account</a></li>
                <li><a href="wishlist.html" class="mobile-nav-link" data-page="wishlist"><i class="ph ph-heart"></i>Wishlist</a></li>
                <li><a href="cart.html" class="mobile-nav-link" data-page="cart"><i class="ph ph-shopping-cart"></i>Carrello</a></li>
                <li><a href="themes.html" class="mobile-nav-link" data-page="themes"><i class="ph ph-palette"></i>Temi</a></li>
            </ul>
        </div>
        <div class="mobile-nav-section">
            <h4>Informazioni</h4>
            <ul class="mobile-nav-list">
                <li><a href="chisiamo.html" class="mobile-nav-link" data-page="chisiamo"><i class="ph ph-info"></i>Chi Siamo</a></li>
                <li><a href="faq.html" class="mobile-nav-link" data-page="faq"><i class="ph ph-question"></i>FAQ</a></li>
                <li><a href="privacy.html" class="mobile-nav-link" data-page="privacy"><i class="ph ph-shield-check"></i>Privacy</a></li>
                <li><a href="terms.html" class="mobile-nav-link" data-page="terms"><i class="ph ph-file-text"></i>Termini</a></li>
            </ul>
        </div>
    </div>
</div>

<div class="overlay" id="overlay"></div>


<script>
    /**
     * @fileoverview Logica di interattività per la navbar di Cronoshop.
     * Questo script gestisce:
     * - Apertura e chiusura del menu mobile.
     * - Cambio tema (dark/light mode).
     * - Evidenziazione del link della pagina attiva.
     * - Aggiornamento dei badge per carrello e wishlist.
     *
     * @version 2.0
     * @author Cronoshop Team
     */
    
    // Eseguiamo lo script solo dopo che il DOM è stato completamente caricato
    // per assicurarci che tutti gli elementi HTML esistano.
    document.addEventListener('DOMContentLoaded', function() {

        // --- SELEZIONE DEGLI ELEMENTI DEL DOM ---
        // Selezioniamo tutti gli elementi con cui dobbiamo interagire una sola volta
        // per ottimizzare le performance, evitando di cercarli nel DOM ogni volta.
        const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
        const closeMenuBtn = document.querySelector('.close-menu-btn');
        const mobileMenu = document.getElementById('mobileMenu');
        const overlay = document.getElementById('overlay');
        const themeToggleBtn = document.getElementById('themeToggleBtn');
        const themeIcon = themeToggleBtn ? themeToggleBtn.querySelector('i') : null;

        // --- GESTIONE MENU MOBILE ---

        /**
         * Funzione per aprire o chiudere il menu mobile.
         * @param {boolean} isOpen - Se true, apre il menu; se false, lo chiude.
         */
        const toggleMobileMenu = (isOpen) => {
            if (!mobileMenu || !overlay) return; // Controllo di sicurezza
            
            mobileMenu.classList.toggle('active', isOpen);
            overlay.classList.toggle('active', isOpen);
            
            // Blocca lo scroll del body quando il menu è aperto per una migliore UX
            document.body.style.overflow = isOpen ? 'hidden' : '';
        };

        // Associa gli eventi ai pulsanti per aprire e chiudere il menu
        if (mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', () => toggleMobileMenu(true));
        }
        if (closeMenuBtn) {
            closeMenuBtn.addEventListener('click', () => toggleMobileMenu(false));
        }
        if (overlay) {
            overlay.addEventListener('click', () => toggleMobileMenu(false));
        }

        // --- GESTIONE TEMA (DARK/LIGHT MODE) ---

        /**
         * Funzione per applicare il tema (dark o light) e aggiornare l'icona.
         * Si basa sulla classe `ThemeCustomizer` definita in script.js.
         */
        const applyTheme = () => {
            if (!window.themeCustomizer || !themeIcon) return; // Controlla se il gestore temi globale esiste

            const isDarkMode = window.themeCustomizer.settings.theme === 'dark';
            
            // Aggiorna l'icona del pulsante
            themeIcon.className = isDarkMode ? 'ph ph-sun' : 'ph ph-moon';
        };
        
        // Evento per il click sul pulsante del tema
        if (themeToggleBtn && window.themeCustomizer) {
            themeToggleBtn.addEventListener('click', () => {
                // Determina il tema attuale e imposta quello opposto
                const currentTheme = window.themeCustomizer.settings.theme;
                const newTheme = (currentTheme === 'dark') ? 'light' : 'dark';
                
                // Chiama la funzione globale per cambiare il tema
                window.themeCustomizer.setTheme(newTheme);
                
                // Aggiorna l'icona immediatamente
                applyTheme(); 
            });
        }
        
        // --- HIGHLIGHT PAGINA ATTIVA ---
        
        /**
         * Evidenzia il link di navigazione corrispondente alla pagina corrente.
         */
        const highlightActiveLink = () => {
            const currentPagePath = window.location.pathname;
            // Estrae il nome del file (es. "products.html") o rimane vuoto per la root
            const currentPageFile = currentPagePath.split('/').pop() || 'index.html';
            
            // Rimuove l'estensione per ottenere il nome della pagina (es. "products")
            const pageName = currentPageFile.split('.')[0];
            
            // Itera su tutti i link (desktop e mobile)
            document.querySelectorAll('.nav-link[data-page], .mobile-nav-link[data-page]').forEach(link => {
                if (link.dataset.page === pageName) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
        };


        // --- AGGIORNAMENTO BADGE (CARRELLO E WISHLIST) ---

        /**
         * Legge i dati dal localStorage e aggiorna i contatori su carrello e wishlist.
         */
        const updateBadges = () => {
            try {
                // Aggiorna contatore carrello
                const cart = JSON.parse(localStorage.getItem('cronoshop_cart') || '[]');
                const cartCount = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
                const cartBadge = document.querySelector('.cart-count');
                if (cartBadge) {
                    cartBadge.textContent = cartCount;
                    cartBadge.classList.toggle('show', cartCount > 0);
                }

                // Aggiorna contatore wishlist
                const wishlist = JSON.parse(localStorage.getItem('cronoshop_wishlist') || '[]');
                const wishlistCount = wishlist.length;
                const wishlistBadge = document.querySelector('.wishlist-count');
                if (wishlistBadge) {
                    wishlistBadge.textContent = wishlistCount;
                    wishlistBadge.classList.toggle('show', wishlistCount > 0);
                }
            } catch (error) {
                console.error('Errore durante l\'aggiornamento dei badge:', error);
            }
        };

        // --- INIZIALIZZAZIONE ---
        // Funzione per eseguire tutte le operazioni di setup iniziali.
        const initializeNavbar = () => {
            applyTheme();
            highlightActiveLink();
            updateBadges();
            
            // Aggiunge un listener per aggiornare i badge quando i dati cambiano in un'altra scheda
            window.addEventListener('storage', updateBadges);
            
            // Rende la funzione di aggiornamento accessibile globalmente
            // così altre parti del sito (es. cart.js) possono richiamarla.
            if (!window.cronoshopNav) {
                window.cronoshopNav = {};
            }
            window.cronoshopNav.updateBadges = updateBadges;
        };
        
        // Avvia tutto
        initializeNavbar();

    });
                </script>
