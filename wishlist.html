<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Mia Wishlist - Cronoshop</title>
    <meta name="description" content="Visualizza e gestisci i prodotti salvati nella tua wishlist personale su Cronoshop.">
    <link rel="canonical" href="https://www.cronoshop.eu/wishlist.html">
    <link rel="icon" type="image/png" href="assets/cronoshop-logo.png">
    <link rel="apple-touch-icon" href="assets/cronoshop-logo.png">
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        body { padding-top: 70px; }
        .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
        .page-header { text-align: center; margin-bottom: 40px; }
        .page-header h1 { font-size: 2.5rem; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 12px; }
        .wishlist-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 24px; }
        .empty-state { text-align: center; padding: 60px 20px; background: var(--ios-bg-secondary); border-radius: var(--ios-radius-xl); }
        .wishlist-actions { text-align: center; margin-top: 32px; }
    </style>
</head>
<body>
    <div id="navbar-placeholder"></div>

    <main class="container">
        <div class="page-header">
            <h1><i class="ph ph-heart"></i> La Mia Wishlist</h1>
        </div>

        <div class="wishlist-grid" id="wishlistContainer">
            </div>

        <div class="empty-state" id="emptyWishlistState" style="display: none;">
            <h3>La tua wishlist è vuota</h3>
            <p style="color: var(--ios-text-secondary); margin-top: 8px; margin-bottom: 24px;">Aggiungi i prodotti che ti interessano per non perderli di vista!</p>
            <a href="products.html" class="ios-btn ios-btn-primary">
                <i class="ph ph-shopping-bag"></i> Scopri le Offerte
            </a>
        </div>

        <div class="wishlist-actions" id="wishlistActions" style="display: none;">
            <button class="ios-btn ios-btn-secondary" id="clearWishlistBtn">
                <i class="ph ph-trash"></i> Svuota Wishlist
            </button>
        </div>
    </main>

    <div id="footer-placeholder"></div>

    <script src="main.js"></script>
    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const wishlistContainer = document.getElementById('wishlistContainer');
            const emptyState = document.getElementById('emptyWishlistState');
            const actions = document.getElementById('wishlistActions');
            const clearWishlistBtn = document.getElementById('clearWishlistBtn');

            // Carica la wishlist dal localStorage
            let wishlist = JSON.parse(localStorage.getItem('cronoshop_wishlist') || '[]');

            function renderWishlist() {
                // Pulisce il contenitore
                wishlistContainer.innerHTML = '';

                if (wishlist.length === 0) {
                    emptyState.style.display = 'block';
                    actions.style.display = 'none';
                    wishlistContainer.style.display = 'none';
                } else {
                    emptyState.style.display = 'none';
                    actions.style.display = 'block';
                    wishlistContainer.style.display = 'grid';

                    wishlist.forEach(product => {
                        const card = document.createElement('div');
                        card.className = 'ios-product-card'; // Riusiamo lo stile delle card prodotto
                        card.innerHTML = `
                            <div class="ios-product-image">
                                <img src="${product.img}" alt="${product.nome}" loading="lazy">
                            </div>
                            <div class="ios-product-info">
                                <div class="ios-product-category">${product.categoria}</div>
                                <h3 class="ios-product-title">${product.nome}</h3>
                                <div class="ios-product-price">
                                    <span class="ios-price-current">€${parseFloat(product.prezzo).toFixed(2)}</span>
                                    ${product.prezzo_originale ? `<span class="ios-price-original">€${parseFloat(product.prezzo_originale).toFixed(2)}</span>` : ''}
                                </div>
                                <div class="ios-product-actions">
                                    <button class="ios-btn ios-btn-primary ios-btn-small" onclick="handleMoveToCart('${product.id}')">
                                        <i class="ph ph-shopping-cart"></i> Sposta nel Carrello
                                    </button>
                                    <button class="ios-btn ios-btn-secondary ios-btn-icon" onclick="handleRemoveFromWishlist('${product.id}')" title="Rimuovi">
                                        <i class="ph ph-trash"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                        wishlistContainer.appendChild(card);
                    });
                }
                 // Aggiorna il badge nella navbar
                if (window.cronoshopNav && typeof window.cronoshopNav.updateBadges === 'function') {
                    window.cronoshopNav.updateBadges();
                }
            }

            window.handleRemoveFromWishlist = (productId) => {
                wishlist = wishlist.filter(p => p.id !== productId);
                localStorage.setItem('cronoshop_wishlist', JSON.stringify(wishlist));
                app.showNotification('Prodotto rimosso dalla wishlist', 'success');
                renderWishlist();
            };

            window.handleMoveToCart = (productId) => {
                // Aggiungi al carrello usando la funzione globale
                app.addToCart(productId);
                // Rimuovi dalla wishlist
                handleRemoveFromWishlist(productId);
            };

            clearWishlistBtn.addEventListener('click', () => {
                if (confirm('Sei sicuro di voler svuotare la wishlist?')) {
                    wishlist = [];
                    localStorage.setItem('cronoshop_wishlist', JSON.stringify(wishlist));
                    app.showNotification('Wishlist svuotata!', 'success');
                    renderWishlist();
                }
            });

            // Renderizza la wishlist al caricamento della pagina
            renderWishlist();
        });
    </script>
    <script>
    // Funzione per caricare componenti HTML esterni
    function loadComponent(url, placeholderId) {
        fetch(url)
            .then(response => response.ok ? response.text() : Promise.reject('Errore nel caricamento'))
            .then(data => {
                const placeholder = document.getElementById(placeholderId);
                if (!placeholder) return;
                
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = data;
                
                // Estrai e aggiungi al DOM gli stili e gli script dalla navbar caricata
                // Questi gestiscono i tag <style> e <script> che erano dentro nav.html/footer.html
                tempDiv.querySelectorAll('style').forEach(styleTag => {
                    const newStyle = document.createElement('style');
                    newStyle.textContent = styleTag.textContent;
                    document.head.appendChild(newStyle);
                });

                tempDiv.querySelectorAll('script').forEach(scriptTag => {
                    const newScript = document.createElement('script');
                    if (scriptTag.src) {
                        newScript.src = scriptTag.src;
                    } else {
                        newScript.textContent = scriptTag.textContent;
                    }
                    document.body.appendChild(newScript);
                });

                // Inserisci il contenuto HTML (senza gli script/stili già spostati)
                // Usiamo un clone per evitare di reinserire gli script/stili
                const contentToInsert = tempDiv.cloneNode(true); 
                contentToInsert.querySelectorAll('style, script').forEach(el => el.remove()); // Rimuovi gli script/stili dal clone
                placeholder.innerHTML = contentToInsert.innerHTML;
            })
            .catch(error => console.error(`Impossibile caricare ${url}: ${error}`));
    }

    // Inizializza al caricamento del DOM
    document.addEventListener('DOMContentLoaded', () => {
        loadComponent('nav.html', 'navbar-placeholder');
        loadComponent('footer.html', 'footer-placeholder');
        // Se hai altri script specifici della pagina che devono inizializzare qualcosa
        // dopo che tutti i componenti sono caricati (es. la classe CronoAI per cronoai.html),
        // assicurati di chiamarli qui.
        // ESEMPIO: if (window.CronoAI) { window.cronoAI = new CronoAI(); }
        // Oppure, se CronoAI è già un'istanza globale e si inizializza da sola, non serve altro.
    });
</script>

</body>
</html>
